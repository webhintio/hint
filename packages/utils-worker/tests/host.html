<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Worker Host</title>
    </head>
    <body>
        <h1>Worker Host</h1>
        <script>
            const worker = new Worker('../bundle/content-script/webhint.js');
            worker.addEventListener('message', (event) => {
                console.log('Received', event);
                if (event.data.requestConfig) {
                    worker.postMessage({
                        config: {
                            locale: 'en-US',
                            resource: 'http://localhost'
                        }
                    });
                } else if (event.data.ready) {
                    worker.postMessage({ fetchStart: 'http://localhost' });
                    worker.postMessage({ fetchEnd: {
                            element: null,
                            request: {
                                headers: {},
                                url: 'http://localhost'
                            },
                            resource: 'http://localhost',
                            response: {
                                body: {
                                    content: '<!doctype html><html><body><form><button>Test</button></form></body></html>',
                                    rawContent: null,
                                    rawResponse: null
                                },
                                charset: '',
                                headers: { 'content-type': 'text/html' },
                                hops: [],
                                mediaType: '',
                                statusCode: 200,
                                url: 'http://localhost'
                            }
                        }
                    });
                    worker.postMessage({
                        snapshot: {
                            "type": "root",
                            "name": "root",
                            "parent": null,
                            "prev": null,
                            "next": null,
                            "children": [
                                {
                                    "type": "directive",
                                    "name": "!doctype",
                                    "data": "!DOCTYPE html \"\"",
                                    "x-name": "html",
                                    "x-publicId": "",
                                    "x-systemId": "",
                                    "parent": null,
                                    "sourceCodeLocation": {
                                        "startLine": 1,
                                        "startCol": 1,
                                        "startOffset": 0,
                                        "endLine": 1,
                                        "endCol": 16,
                                        "endOffset": 15
                                    },
                                    "next": null
                                },
                                {
                                    "type": "tag",
                                    "name": "html",
                                    "namespace": "http://www.w3.org/1999/xhtml",
                                    "attribs": {},
                                    "x-attribsNamespace": {},
                                    "x-attribsPrefix": {},
                                    "children": [
                                        {
                                            "type": "tag",
                                            "name": "head",
                                            "namespace": "http://www.w3.org/1999/xhtml",
                                            "attribs": {},
                                            "x-attribsNamespace": {},
                                            "x-attribsPrefix": {},
                                            "children": [],
                                            "parent": null,
                                            "prev": null,
                                            "next": null,
                                            "sourceCodeLocation": null
                                        },
                                        {
                                            "type": "tag",
                                            "name": "body",
                                            "namespace": "http://www.w3.org/1999/xhtml",
                                            "attribs": {},
                                            "x-attribsNamespace": {},
                                            "x-attribsPrefix": {},
                                            "children": [
                                                {
                                                    "type": "tag",
                                                    "name": "form",
                                                    "namespace": "http://www.w3.org/1999/xhtml",
                                                    "attribs": {},
                                                    "x-attribsNamespace": {},
                                                    "x-attribsPrefix": {},
                                                    "children": [
                                                        {
                                                            "type": "tag",
                                                            "name": "button",
                                                            "namespace": "http://www.w3.org/1999/xhtml",
                                                            "attribs": {},
                                                            "x-attribsNamespace": {},
                                                            "x-attribsPrefix": {},
                                                            "children": [
                                                                {
                                                                    "type": "text",
                                                                    "data": "Test",
                                                                    "parent": null,
                                                                    "prev": null,
                                                                    "next": null,
                                                                    "sourceCodeLocation": {
                                                                        "startLine": 1,
                                                                        "startCol": 52,
                                                                        "startOffset": 51,
                                                                        "endLine": 1,
                                                                        "endCol": 56,
                                                                        "endOffset": 55
                                                                    }
                                                                }
                                                            ],
                                                            "parent": null,
                                                            "prev": null,
                                                            "next": null,
                                                            "sourceCodeLocation": {
                                                                "startLine": 1,
                                                                "startCol": 44,
                                                                "startOffset": 43,
                                                                "endLine": 1,
                                                                "endCol": 65,
                                                                "endOffset": 64,
                                                                "startTag": {
                                                                    "startLine": 1,
                                                                    "startCol": 44,
                                                                    "startOffset": 43,
                                                                    "endLine": 1,
                                                                    "endCol": 52,
                                                                    "endOffset": 51
                                                                },
                                                                "endTag": {
                                                                    "startLine": 1,
                                                                    "startCol": 56,
                                                                    "startOffset": 55,
                                                                    "endLine": 1,
                                                                    "endCol": 65,
                                                                    "endOffset": 64
                                                                }
                                                            }
                                                        }
                                                    ],
                                                    "parent": null,
                                                    "prev": null,
                                                    "next": null,
                                                    "sourceCodeLocation": {
                                                        "startLine": 1,
                                                        "startCol": 38,
                                                        "startOffset": 37,
                                                        "endLine": 1,
                                                        "endCol": 72,
                                                        "endOffset": 71,
                                                        "startTag": {
                                                            "startLine": 1,
                                                            "startCol": 38,
                                                            "startOffset": 37,
                                                            "endLine": 1,
                                                            "endCol": 44,
                                                            "endOffset": 43
                                                        },
                                                        "endTag": {
                                                            "startLine": 1,
                                                            "startCol": 65,
                                                            "startOffset": 64,
                                                            "endLine": 1,
                                                            "endCol": 72,
                                                            "endOffset": 71
                                                        }
                                                    }
                                                }
                                            ],
                                            "parent": null,
                                            "prev": null,
                                            "next": null,
                                            "sourceCodeLocation": {
                                                "startLine": 1,
                                                "startCol": 32,
                                                "startOffset": 31,
                                                "endLine": 1,
                                                "endCol": 86,
                                                "endOffset": 85,
                                                "startTag": {
                                                    "startLine": 1,
                                                    "startCol": 32,
                                                    "startOffset": 31,
                                                    "endLine": 1,
                                                    "endCol": 38,
                                                    "endOffset": 37
                                                },
                                                "endTag": {
                                                    "startLine": 1,
                                                    "startCol": 72,
                                                    "startOffset": 71,
                                                    "endLine": 1,
                                                    "endCol": 79,
                                                    "endOffset": 78
                                                }
                                            }
                                        }
                                    ],
                                    "parent": null,
                                    "prev": null,
                                    "next": null,
                                    "sourceCodeLocation": {
                                        "startLine": 1,
                                        "startCol": 16,
                                        "startOffset": 15,
                                        "endLine": 1,
                                        "endCol": 86,
                                        "endOffset": 85,
                                        "attrs": {
                                            "lang": {
                                                "startLine": 1,
                                                "startCol": 22,
                                                "startOffset": 21,
                                                "endLine": 1,
                                                "endCol": 31,
                                                "endOffset": 30
                                            }
                                        },
                                        "startTag": {
                                            "startLine": 1,
                                            "startCol": 16,
                                            "startOffset": 15,
                                            "endLine": 1,
                                            "endCol": 32,
                                            "endOffset": 31,
                                            "attrs": {
                                                "lang": {
                                                    "startLine": 1,
                                                    "startCol": 22,
                                                    "startOffset": 21,
                                                    "endLine": 1,
                                                    "endCol": 31,
                                                    "endOffset": 30
                                                }
                                            }
                                        },
                                        "endTag": {
                                            "startLine": 1,
                                            "startCol": 79,
                                            "startOffset": 78,
                                            "endLine": 1,
                                            "endCol": 86,
                                            "endOffset": 85
                                        }
                                    }
                                }
                            ],
                            "x-mode": "no-quirks"
                        }
                    });
                }
            })
        </script>
    </body>
</html>
